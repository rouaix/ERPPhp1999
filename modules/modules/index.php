<?phpif(file_exists("../../securite.php")){include("../../securite.php");}modules_droits();if(!isset($_SESSION["table"]) or $_SESSION["table"] == ""){$_SESSION["table"] = $_SESSION["page"];}        echo "<table width=\"100%\"><tr>";    echo "<td width=\"50%\">";    echo "<div class=\"module\" id=\"ligne\" style=\"text-align:center;\">";    echo "<form enctype=\"multipart/form-data\" name=\"a\" method=\"post\" action=\"".$_SESSION["lien"]."\">\n";    echo "<input type=\"hidden\" name=\"action\" value=\"creationmodule\">";    //echo "<input type=\"hidden\" id=\"creationmodule\" name=\"creationmodule\" value=\"\">";        echo "<label id=\"gauche\">Nouveau module</label>";    echo "Table";        echo "<input type=\"checkbox\" id=\"inline\" name=\"moduletable\" title=\"Table\" value=\"oui\">";    echo "Dossier";    echo "<input type=\"checkbox\" id=\"inline\" name=\"modulerepertoire\" title=\"Dossier\" value=\"oui\">";            echo "Nom";    //echo "<input type=\"text\" id=\"inline\" name=\"creationmodule\" value=\"\" onchange=\"setvaleurid('creationmodule',this.value);\">";    echo "<input type=\"text\" id=\"inline\" name=\"creationmodule\" value=\"\">";    echo "<input type=\"image\" src=\"".$_SESSION["ico"]["valider"]."\" value=\"Valider\" id=\"i16\" title=\"Cliquez pour valider\">";      echo "</form>";    echo "</div>\n";    echo "</td>\n";    echo "<td width=\"50%\">";    echo "<div class=\"module\" id=\"ligne\" style=\"text-align:center;\">";    echo "<form enctype=\"multipart/form-data\" name=\"b\" method=\"post\" action=\"".$_SESSION["lien"]."\">\n";    echo "<input type=\"hidden\" name=\"action\" value=\"sauvedata\">";    echo "<input type=\"hidden\" name=\"table\" value=\"droits\">";    echo "<input type=\"hidden\" name=\"form_type_droits\" value=\"module\">";    echo "<input type=\"hidden\" name=\"retourtable\" value=\"".@$_SESSION["table"]."\">";    echo "<label id=\"gauche\">Ajouter une autorisation</label>";        echo "Nom<input type=\"text\" id=\"inline\" name=\"form_nom_droits\" value=\"\">";    echo "<input type=\"image\" src=\"".$_SESSION["ico"]["valider"]."\" value=\"Valider\" id=\"i16\" title=\"Cliquez pour valider\">";        echo "</form>";    echo "</div>";    echo "</td>\n";    echo "</tr></table>\n";        echo "<div class=\"module\">";    echo "<table>\n";    echo "<tr>\n";      echo "<td id=\"milieu\">";      echo "<b>Liste des Modules</b>";      echo "</td>\n";      $droits = cherche_liste_droit_modules();      reset($droits);      while (list($key, $val) = each($droits)){        echo "<td class=\"module\" id=\"droits\">";               echo "<a title=\"Modifier\" href=\"javascript:voir('popup');ajaxpage(rootdomain+'scripts/inc.popup.php?table=droits&acte=formulaire&formulaire=modifier&modifier=".$val["id_droits"]."','surpopup');loadobjs();\"><b>".ucfirst($val["nom_droits"])."</b></a>";        echo "<hr>";                echo "<a class=\"module\" href=\"".$_SESSION["lien"]."?table=droits&retourtable=".@$_SESSION["table"]."&action=effaceligne&effaceligne=".$val["id_droits"]."\" title=\"Supprimer !\">";        echo "<img src=\"".$_SESSION["ico"]["supprimer"]."\" id=\"i10\"></a>";                        echo "<br>N° ".$val["id_droits"]."";        if($val["info_droits"] != ""){echo "<hr><i class=\"module\">".$val["info_droits"]."</i>";}        echo "";        echo "</td>\n";      }          echo "</tr>\n";        $r = mysql_query("select * from modules where type_modules='module' order by nom_modules asc");        while ($mod = @mysql_fetch_array($r)){      echo "<tr id=\"hover\">\n";        echo "<td class=\"module\" id=\"nom\">";        echo lien_kill($mod);        if(isset($mod["icone_modules"]) && $mod["icone_modules"] != ""){echo "<img src=\"".$mod["icone_modules"]."\" id=\"i24\">";}        echo lien_supprimer($mod["id_modules"]);        echo lien_eediter($mod);        echo "&nbsp;<i>(".$mod["info_modules"].")</i> - N° ".$mod["id_modules"]."";        echo "</td>\n";                reset($droits);        while (list($keydroit, $valdroit) = each($droits)){          echo "<td class=\"module\" id=\"droits\">";                    $s = mysql_query("select * from droits where id_module='".$mod["id_modules"]."' and valeur_droits='".$valdroit["id_droits"]."' and nom_droits='droits' and type_droits='module' order by nom_droits asc");          $l = mysql_fetch_array($s);                    if(isset($l) && $l != ""){            echo "<a class=\"module\" href=\"".$_SESSION["lien"]."?table=droits&retourtable=modules&action=effaceligne&effaceligne=".$l["id_droits"]."\" title=\"Annuler !\n".ucfirst($valdroit["nom_droits"]).".".ucfirst($valdroit["info_droits"])." => ".ucfirst($mod["nom_modules"])."\">";            echo "<img src=\"".$_SESSION["ico"]["actif"]."\" class=\"module\">";            echo "</a>";          }else{            echo "<a class=\"module\" href=\"".$_SESSION["lien"]."?";            echo "table=droits";            echo "&retourtable=modules";            echo "&form_type_droits=module";            echo "&form_nom_droits=droits";            echo "&action=sauvedata";            echo "&form_valeur_droits=".$valdroit["id_droits"];            //echo "&form_contenu=".$keydroit;            echo "&form_nom_module=".$mod["nom_modules"];            echo "&form_id_module=".$mod["id_modules"];            //echo "&form_pere=".$mod["id"];            echo "\" title=\"Autoriser !\n".ucfirst($valdroit["nom_droits"]).".".ucfirst($valdroit["info_droits"])." => ".ucfirst($mod["nom_modules"])."\">";                       echo "<img src=\"".$_SESSION["ico"]["inactif"]."\" class=\"module\">";            echo "</a>";          }          echo "</td>\n";        }      echo "</tr>\n";    }    echo "</table>\n";    echo "</div>\n";    unset($droits);function lien_kill($val){  return "<a title=\"Tout supprimer (Table, fichiers, Dossier, Etc.)\" href=\"".$_SESSION["lien"]."?table=modules&action=supprimermodule&supprimermodule=".$val[1]."&supprimermoduleid=".$val[0]."\"><img src=\"".$_SESSION["ico"]["supprimer"]."\" id=\"image10\" style=\"margin-left:5px;margin-right:5px;\"></a>";}function lien_eediter($val){  return "<a title=\"Modifier\" href=\"javascript:voir('popup');ajaxpage(rootdomain+'scripts/inc.popup.php?table=modules&acte=formulaire&formulaire=modifier&modifier=".$val[0]."','surpopup');loadobjs();\"><b>".ucfirst($val[1])."</b></a>";}function lien_supprimer($id){  return "<a class=\"module\" href=\"".$_SESSION["lien"]."?table=modules&action=effaceligne&effaceligne=".$id."\" title=\"Supprimer !\"><img src=\"".$_SESSION["ico"]["effacer"]."\" id=\"image10\" style=\"margin-left:5px;margin-right:10px;\"></a>";}function cherche_liste_droit_modules(){  //$x = array();  //$result = mysql_query("select * from modules where droits='module' and type='droits' order by nom asc");  //while ($ligne = @mysql_fetch_array($result)){    //$x[$ligne["nom"]]= $ligne;  //}  //return $x;  $x = array();  $result = mysql_query("select * from droits where type_droits='module' and nom_droits !='droits' and id_module='0' order by nom_droits asc");  while ($ligne = @mysql_fetch_array($result)){    $x[$ligne["id_droits"]]= $ligne;  }  return $x;}?>